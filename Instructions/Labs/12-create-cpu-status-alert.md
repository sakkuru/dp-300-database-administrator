---
lab:
    title: 'Lab 12 – SQL Server の CPU ステータス アラートを作成する'
    module: 'Azure SQL のデータベース タスクを自動化する'
---

# Azure 上の SQL Server の CPU ステータスアラートを作成する

**見積もり時間: 30 分**

あなたは、データベース管理の日常業務を自動化するために、シニアデータエンジニアとして採用されました。この自動化は、AdventureWorksのデータベースが最高のパフォーマンスで動作し続けることを保証するだけでなく、特定の基準に基づいてアラートするための方法を提供することを支援するものです。

## CPUが平均80パーセントを超えたらアラートを作成する

1. Azureポータル上部の検索バーで、**SQL**と入力し、**SQLデータベース**を選択します。表示された **AdventureWorksLT** データベース名を選択します。

    ![SQLデータベースを選択する画面](../images/dp-300-module-12-lab-01.png)

1. **AdventureWorksLT** データベースのメインブレードで、監視セクションまで移動します。**警告**を選択します。

    ![SQLデータベースの概要ページでAlertsを選択する画面](../images/dp-300-module-12-lab-02.png)

1. **アラートルールの作成**を選択します。

    ![新規アラートルールを選択した画面](../images/dp-300-module-12-lab-03.png)

1. **シグナルの選択** スライドアウトで **CPU percentage** を選択します。

    ![CPUパーセンテージを選択した画面](../images/dp-300-module-12-lab-04.png)

1. **しきい値** プロパティに **Static** を選択します。次に、**演算子** プロパティが **次の値より大きい** で、**集計の種類** タイプが **平均** であることを確認します。次に **しきい値** に **80** という値を入力します。**次へ**を選択します。

    ![80を入力してDoneを選択した画面](../images/dp-300-module-12-lab-05.png)

1. **アクション**タブを選択します。

    ![アクショングループの選択リンクを選択した画面](../images/dp-300-module-12-lab-06.png)

1. **アクション**タブで、[アクショングループの作成]**を選択する。

    ![アクショングループの作成を選択した画面](../images/dp-300-module-12-lab-07.png)

1. **アクショングループ**の画面で、**アクショングループ名**の欄に**emailgroup**と入力し、**次へ**を選択します。**通知**を選択します。

    ![emailgroupを入力し、Next: Notificationsを選択した画面](../images/dp-300-module-12-lab-08.png)

1. **通知**タブで、以下の情報を入力します。

    - **通知タイプ：** 電子メール/SMSメッセージ/プッシュ/音声
        - **Note:** このオプションを選択すると、Email/SMS メッセージ/Push/Voice のフライアウトが表示されます。Email プロパティをチェックし、サインインした Azure ユーザー名を入力します。
    - **名前:** DemoLab

    ![情報を追加したアクショングループ作成ページのスクリーンショット](../images/dp-300-module-12-lab-09.png)

1. **確認と作成**を選択し、**作成**を選択します。

    ![アラートルールの作成を選択したアラートルール作成ページの画面](../images/dp-300-module-12-lab-10.png)

    **注意:** **作成** を選択する前に、**Test action group (preview)** を選択してアラートをテストすることも可能です。

1. ルールが作成されると、入力したメールアドレスにこのようなメールが送信されます。

    ![確認メールのスクリーンショット](../images/dp-300-module-12-lab-11.png)

    アラートを設定すると、CPU使用率が平均で80%を超えると、このようなメールが送信されます。

    ![警告メールのスクリーンショット](../images/dp-300-module-12-lab-12.png)

アラートは、ある指標（例えばデータベースサイズやCPU使用率など）が定義した閾値に達すると、メールを送信したり、Webフックを呼び出したりすることができます。ここまでで、Azure SQL Databasesのアラートを簡単に設定する方法を確認しました。
