---
lab:
    title: 'ラボ14: Azure SQL Database 用に geo レプリケーションを構成する'
    module: '高可用性と災害復旧ソリューションの計画と実装'
---

# ラボ14: Azure SQL Database 用に geo レプリケーションを構成する

**見積もり時間：30分**

AdventureWorksのDBAとして、Azure SQL Databaseのジオレプリケーションを有効にし、正しく動作していることを確認する必要があります。さらに、ポータルを使用して手動で別のリージョンにフェイルオーバーすることになります。

## ジオレプリケーションの有効化

1. ラボの仮想マシンから、ブラウザ セッションを開始し、[https://portal.azure.com](https://portal.azure.com/) に移動します。このラボ仮想マシンの **Resources** タブで提供された Azure **Username** と **Password** を使用して、ポータルに接続します。

1. Azure ポータルで、**sql databases** を検索して、データベースに移動します。

    ![既存の SQL データベースを検索する画面](../images/dp-300-module-13-lab-03.png)

1. SQLデータベース **AdventureWorksLT** を選択します。

1. データベースのブレードで、**データ管理**セクションで、**レプリカ**を選択します。

    ![Geo-Replicationを選択している画面](../images/dp-300-module-14-lab-01.png)

1. **レプリカの作成**を選択します。

    ![Geo-Replicationページを選択した画面](../images/dp-300-module-14-lab-02.png)

1. **SQL Database - geo レプリカの作成**ページで、**サーバー**の下にある**新規作成**リンクを選択します。

    ![サーバーの新規作成リンクを表示した画面](../images/dp-300-module-14-lab-03.png)

    >[!注意]。
    > セカンダリデータベースをホストするために新しいサーバーを作成するので、上記のエラーメッセージは無視できます。

1. **Create SQL Database Server** ページで、お好みの一意の **サーバー名**と**場所**を選択します。

1. SQL認証を選択し、有効な**サーバー管理者ログイン**、セキュかな**パスワード** を入力します。**OK**を選択してサーバーを作成します。

    ![SQLデータベース・サーバーの作成ページのスクリーンショット](../images/dp-300-module-14-lab-04.png)

1. **SQL Database - geo レプリカの作成** ページに戻り、**確認および作成** を選択します。

    ![SQLデータベースサーバーの作成画面](../images/dp-300-module-14-lab-05.png)を選択します。

1. **作成**を選択します。

1. これで、セカンダリサーバとデータベースが作成されます。

## SQL Database をセカンダリーリージョンにフェイルオーバーする

Azure SQL Database のレプリカが作成されたので、フェイルオーバーを実行します。

1. SQL サーバー ページに移動し、リストに新しいサーバーがあることに気づきます。セカンダリーサーバーを選択します（サーバー名が異なる場合があります）。

    ![SQLサーバーページの画面](../images/dp-300-module-14-lab-09.png)

1. SQLサーバーのブレードで、**設定**セクションで、**SQL データベース**を選択します。

    ![SQLデータベースオプションの画面](../images/dp-300-module-14-lab-10.png)

1. SQLデータベースのメインブレードで、**データ管理**セクションから**レプリカ**を選択します。

1. ジオレプリケーションのリンクが確立されていることに注意してください。

    ![レプリカを選択した画面](../images/dp-300-module-14-lab-11.png)

1. セカンダリサーバーの **...** メニューを選択し、**強制フェールオーバー**を選択します。

    ![強制フェイルオーバーオプションを示すスクリーンショット](../images/dp-300-module-14-lab-12.png)

    > [!注意]
    > 強制フェイルオーバーでは、セカンダリデータベースがプライマリの役割に切り替わります。この操作の間、すべてのセッションは切断されます。

1. 警告メッセージが表示されたら、[**はい**]をクリックします。

    ![強制フェイルオーバーの警告メッセージのスクリーンショット](../images/dp-300-module-14-lab-13.png)

1. プライマリレプリカのステータスが**保留中**に、セカンダリレプリカのステータスが**フェイルオーバー**に切り替わります。

    ![強制フェイルオーバーの警告メッセージのスクリーンショット](../images/dp-300-module-14-lab-14.png)

    > [!注意]
    > この処理には数分かかることがあります。完了すると、セカンダリが新しいプライマリに、古いプライマリがセカンダリになり、役割が切り替わります。

ここまでで、読み取り可能なセカンダリデータベースは、プライマリと同じ Azure リージョンにある場合もあれば、異なるリージョンにある場合もあることがわかりました。このような読み取り可能なセカンダリデータベースは、ジオセカンダリ、またはジオレプリカとも呼ばれます。

ここまでで、Azure SQL Databaseのジオレプリカを有効にする方法と、ポータルを使って手動で別のリージョンにフェイルオーバーさせる方法を確認しました。
